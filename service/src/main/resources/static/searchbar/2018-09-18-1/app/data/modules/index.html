<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Maps</title>
  <style>
    /* Set the size of the div element that contains the map */
    #mape {
      height: 400px;  /* The height is 400 pixels */
      width: 500px;  /* The width is the width of the web page */
    }
  </style>
<link href="GoogleMaps/GoogleMaps.bundle.css" rel="stylesheet"><link href="Timeline/Timeline.bundle.css" rel="stylesheet"></head>
<body>
<h1>TIMELINE</h1>
<div id="ifs-timeline" style="width: 700px; height: 390px; border: 1px solid lightgray;"></div>


<h1>here is google maps</h1>
<!--The div element for the map -->
<div id="mape"></div>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://underscorejs.org/underscore.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>

<script type="text/javascript">
  $(document).ready(() => {

    function getYearData() {
      return {
        "timelines": [
          {
            "1974-01-01 00:00:00": 1,
            "year": 1974
          },
          {
            "year": 1979,
            "1979-01-01 00:00:00": 161
          },
          {
            "year": 1980,
            "1980-01-01 00:00:00": 39
          },
          {
            "1981-01-01 00:00:00": 1,
            "year": 1981
          },
          {
            "year": 1982,
            "1982-01-01 00:00:00": 1
          },
          {
            "year": 1983,
            "1983-01-01 00:00:00": 1
          },
          {
            "year": 1984,
            "1984-01-01 00:00:00": 3
          },
          {
            "1985-01-01 00:00:00": 1,
            "year": 1985
          },
          {
            "year": 1986,
            "1986-01-01 00:00:00": 1
          },
          {
            "year": 1987,
            "1987-01-01 00:00:00": 2
          },
          {
            "1988-01-01 00:00:00": 15,
            "year": 1988
          },
          {
            "year": 1989,
            "1989-01-01 00:00:00": 8
          },
          {
            "year": 1990,
            "1990-01-01 00:00:00": 14
          },
          {
            "year": 1991,
            "1991-01-01 00:00:00": 71
          },
          {
            "1992-01-01 00:00:00": 85,
            "year": 1992
          },
          {
            "year": 1993,
            "1993-01-01 00:00:00": 302
          },
          {
            "year": 1994,
            "1994-01-01 00:00:00": 415
          },
          {
            "1995-01-01 00:00:00": 1045,
            "year": 1995
          },
          {
            "year": 1996,
            "1996-01-01 00:00:00": 2101
          },
          {
            "year": 1997,
            "1997-01-01 00:00:00": 4868
          },
          {
            "year": 1998,
            "1998-01-01 00:00:00": 6813
          },
          {
            "1999-01-01 00:00:00": 25673,
            "year": 1999
          },
          {
            "year": 2000,
            "2000-01-01 00:00:00": 32354
          },
          {
            "year": 2001,
            "2001-01-01 00:00:00": 41122
          },
          {
            "year": 2002,
            "2002-01-01 00:00:00": 45763
          },
          {
            "year": 2003,
            "2003-01-01 00:00:00": 63046
          },
          {
            "year": 2004,
            "2004-01-01 00:00:00": 74658
          },
          {
            "2005-01-01 00:00:00": 104618,
            "year": 2005
          },
          {
            "year": 2006,
            "2006-01-01 00:00:00": 358739
          },
          {
            "year": 2007,
            "2007-01-01 00:00:00": 145713
          },
          {
            "year": 2008,
            "2008-01-01 00:00:00": 157014
          },
          {
            "2009-01-01 00:00:00": 250818,
            "year": 2009
          },
          {
            "year": 2010,
            "2010-01-01 00:00:00": 32430
          },
          {
            "year": 2011,
            "2011-01-01 00:00:00": 45911
          },
          {
            "2012-01-01 00:00:00": 37849,
            "year": 2012
          },
          {
            "year": 2013,
            "2013-01-01 00:00:00": 41945
          },
          {
            "year": 2014,
            "2014-01-01 00:00:00": 36770
          },
          {
            "year": 2015,
            "2015-01-01 00:00:00": 36265
          },
          {
            "2016-01-01 00:00:00": 121608,
            "year": 2016
          },
          {
            "year": 2017,
            "2017-01-01 00:00:00": 152699
          },
          {
            "year": 2018,
            "2018-01-01 00:00:00": 24125
          },
          {
            "2019-01-01 00:00:00": 1,
            "year": 2019
          },
          {
            "year": 2028,
            "2028-01-01 00:00:00": 1
          },
          {
            "2286-01-01 00:00:00": 1,
            "year": 2286
          }
        ],
        "dateranges": [
          {
            "range": "last hour",
            "count": 10
          },
          {
            "range": "last 24 hours",
            "count": 619
          },
          {
            "range": "last 7 days",
            "count": 1553
          },
          {
            "range": "last 30 days",
            "count": 4917
          },
          {
            "range": "last 365 days",
            "count": 41903
          }
        ],
        "parameters": [
          {
            "action": [
              "gettimelinedata"
            ],
            "iSearchIndex": [
              "1##c2VhcmNocHJvZmlsZS1zdGFuZGFyZA=="
            ],
            "sGranularity": [
              "y"
            ],
            "sSearchTerm": [
              "*"
            ],
            "_": [
              "1533629196175"
            ]
          }
        ]
      };
    }

    function getMonthData() {
      return {
        "timelines": [
          {
            "1999-05-01 00:00:00": 2871,
            "1999-04-01 00:00:00": 2607,
            "1999-06-01 00:00:00": 2543,
            "year": 1999,
            "1999-01-01 00:00:00": 565,
            "1999-09-01 00:00:00": 2666,
            "1999-12-01 00:00:00": 2445,
            "1999-02-01 00:00:00": 861,
            "1999-03-01 00:00:00": 1390,
            "1999-11-01 00:00:00": 2208,
            "1999-08-01 00:00:00": 2666,
            "1999-07-01 00:00:00": 2584,
            "1999-10-01 00:00:00": 2267
          },
          {
            "2000-02-01 00:00:00": 2815,
            "2000-01-01 00:00:00": 2897,
            "2000-03-01 00:00:00": 2872,
            "2000-12-01 00:00:00": 2417,
            "year": 2000,
            "2000-06-01 00:00:00": 2723,
            "2000-05-01 00:00:00": 2508,
            "2000-04-01 00:00:00": 2437,
            "2000-09-01 00:00:00": 2830,
            "2000-07-01 00:00:00": 2861,
            "2000-10-01 00:00:00": 2753,
            "2000-08-01 00:00:00": 2769,
            "2000-11-01 00:00:00": 2472
          },
          {
            "2001-07-01 00:00:00": 3705,
            "2001-09-01 00:00:00": 2902,
            "year": 2001,
            "2001-06-01 00:00:00": 3210,
            "2001-08-01 00:00:00": 3222,
            "2001-11-01 00:00:00": 4955,
            "2001-01-01 00:00:00": 2948,
            "2001-10-01 00:00:00": 3593,
            "2001-12-01 00:00:00": 3549,
            "2001-02-01 00:00:00": 2747,
            "2001-03-01 00:00:00": 3035,
            "2001-05-01 00:00:00": 3628,
            "2001-04-01 00:00:00": 3628
          }
        ],
        "dateranges": [
          {
            "range": "last hour",
            "count": 0
          },
          {
            "range": "last 24 hours",
            "count": 0
          },
          {
            "range": "last 7 days",
            "count": 0
          },
          {
            "range": "last 30 days",
            "count": 0
          },
          {
            "range": "last 365 days",
            "count": 0
          }
        ],
        "parameters": [
          {
            "action": [
              "gettimelinedata"
            ],
            "iSearchIndex": [
              "1##c2VhcmNocHJvZmlsZS1zdGFuZGFyZA=="
            ],
            "sGranularity": [
              "m"
            ],
            "sSearchTerm": [
              "*"
            ],
            "sFilter0": [
              "++DateRange|[\"1999-01-01 TO 2001-12-31\"]"
            ],
            "_": [
              "1533629615668"
            ]
          }
        ]
      };
    }

    function getDayData() {
      return {
        "timelines": [
          {
            "1999-12-31 00:00:00": 1,
            "year": 1999
          },
          {
            "2000-01-01 00:00:00": 21,
            "2000-01-30 00:00:00": 36,
            "2000-01-04 00:00:00": 261,
            "2000-01-07 00:00:00": 142,
            "2000-01-24 00:00:00": 119,
            "year": 2000,
            "2000-01-16 00:00:00": 48,
            "2000-01-19 00:00:00": 101,
            "2000-01-12 00:00:00": 130,
            "2000-01-21 00:00:00": 107,
            "2000-01-03 00:00:00": 116,
            "2000-01-28 00:00:00": 121,
            "2000-01-05 00:00:00": 119,
            "2000-01-08 00:00:00": 46,
            "2000-01-23 00:00:00": 50,
            "2000-01-17 00:00:00": 105,
            "2000-01-14 00:00:00": 93,
            "2000-01-20 00:00:00": 187,
            "2000-01-11 00:00:00": 90,
            "2000-01-26 00:00:00": 156,
            "2000-01-02 00:00:00": 25,
            "2000-01-29 00:00:00": 43,
            "2000-01-31 00:00:00": 22,
            "2000-01-25 00:00:00": 109,
            "2000-01-22 00:00:00": 42,
            "2000-01-09 00:00:00": 39,
            "2000-01-06 00:00:00": 98,
            "2000-01-15 00:00:00": 56,
            "2000-01-13 00:00:00": 161,
            "2000-01-18 00:00:00": 128,
            "2000-01-27 00:00:00": 91,
            "2000-01-10 00:00:00": 35
          }
        ],
        "dateranges": [
          {
            "range": "last hour",
            "count": 0
          },
          {
            "range": "last 24 hours",
            "count": 0
          },
          {
            "range": "last 7 days",
            "count": 0
          },
          {
            "range": "last 30 days",
            "count": 0
          },
          {
            "range": "last 365 days",
            "count": 0
          }
        ],
        "parameters": [
          {
            "action": [
              "gettimelinedata"
            ],
            "iSearchIndex": [
              "1##c2VhcmNocHJvZmlsZS1zdGFuZGFyZA=="
            ],
            "sGranularity": [
              "d"
            ],
            "sSearchTerm": [
              "*"
            ],
            "sFilter0": [
              "++DateRange|[\"2000-01-01 TO 2000-01-31\"]"
            ],
            "_": [
              "1533629615678"
            ]
          }
        ]
      };
    }

    function convertTimelineData(data, timelineType) {
      let timelineData = [];
      let allCounts = [];
      data.timelines.forEach((timelineEntry) => {
        Object.keys(timelineEntry).forEach((entryKey) => {
          if (entryKey !== 'year') {
            timelineData.push({
              date: moment(entryKey).toDate(),
              count: timelineEntry[entryKey]
            });
            allCounts.push(timelineEntry[entryKey]);
          }
        });
      });

      return {
        type: timelineType,
        data: _.sortBy(timelineData, 'date'),
        maxVal: _.max(allCounts)
      };
    }

    let timelineData = getMonthData();
    let convertedTimelineData = convertTimelineData(timelineData, timelineData.parameters[0].sGranularity[0]);
    let timeline = new Timeline($, _, moment, 'ifs-timeline');
    timeline.render(convertedTimelineData);


    let geoLocations = [
      "r62sktfqzuxy",
      "r64bjtg1h1d5",
      "r64bju0vm4uf",
      "r3gx2y59stb7",
      "r3gx3j2zd9rg",
      "r3g6bbr94pbn",
      "r39xnuvp0f2q",
      "rckyw1s32n04",
      "rcmn2pw9c164",
      "r1r1npydr3vw"
    ];

    let locations = [
      {lat: -31.563910, lng: 147.154312, label:"1", count:1},
      {lat: -33.718234, lng: 150.363181, label:"10", count:10},
      {lat: -33.727111, lng: 150.371124, label:"100", count:100},
      {lat: -33.848588, lng: 151.209834, label:"4", count:4},
      {lat: -33.851702, lng: 151.216968, label:"6", count:6},
      {lat: -34.671264, lng: 150.863657, label:"7", count:7},
      {lat: -35.304724, lng: 148.662905, label:"8", count:8},
      {lat: -36.817685, lng: 175.699196, label:"1", count:1},
      {lat: -36.828611, lng: 175.790222, label:"2", count:2},
      {lat: -37.750000, lng: 145.116667, label:"13", count:13},
      {lat:-26.424398, lng:-55.065996,label:"13", count:13}
    ];

    let googleMaps = new GoogleMaps($, _ , null, "mape", "AIzaSyAB7ssC0LlhVKkw39R_7IYz4diULgutDnU");

    let callback = (coordinates) => {
      console.log(coordinates);
    };

    let convertedLocations = [];
    for (const [i, geoLocation] of geoLocations.entries() ) {
      convertedLocations.push({lat:GeoHashConverter.geoHashToLatLng(geoLocation).lat, lng: GeoHashConverter.geoHashToLatLng(geoLocation).lng, label: i+1+""});
    }

    googleMaps.initMap(null, {zoom:10, zoomControl: true}).then(() => {
      googleMaps.initAutocomplete();
      googleMaps.setMarkersWithLabel(locations);
      setTimeout( () => {
        googleMaps.deleteMarkers();
        googleMaps.drawCircles(locations);
      }, 300);

      /**
       googleMaps.initClusters().then(() => {
      googleMaps.createClusters(locations);
    }, (err) => {
      console.log("error", err);
    });**/
    }, (err) => {
      console.log("error", err);
    });


    let geoHashLocations = [];
    for ( let location of locations ) {
      geoHashLocations.push(GeoHashConverter.latLngToGeoHash(location.lat, location.lng));
    }
    console.log('geoHashLocations', geoHashLocations);
  });

</script>

<script type="text/javascript" src="GoogleMaps/GoogleMaps.bundle.js"></script><script type="text/javascript" src="GeoHashConverter/GeoHashConverter.bundle.js"></script><script type="text/javascript" src="Timeline/Timeline.bundle.js"></script></body>
</html>
